<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>üå¶Ô∏è Panel de Control - La Calera</h1>
    <button (click)="logout()" class="logout-btn">Cerrar sesi√≥n</button>
  </header>

  <main class="dashboard-content">
    <h2>Resumen hidr√°ulico actual</h2>

    <div *ngIf="loading">Cargando pron√≥stico resumido...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <section *ngIf="!loading && summary as s" class="summary-section">
      <!-- Aqu√≠ lo que ya ten√≠as: riesgo actual, lluvia actual, pr√≥ximas 6h -->
      <p><strong>Riesgo actual:</strong> {{ s.current_risk.level }} - {{ s.current_risk.message }}</p>
      <p><strong>Lluvia actual:</strong> {{ s.current_rain.intensity_mm_h }} mm/h ({{ s.current_rain.label }})</p>
      <p><strong>Pr√≥ximas {{ s.next_hours.window_hours }} horas:</strong> {{ s.next_hours.level }} ‚Äî Lluvia acumulada: {{ s.next_hours.accumulated_mm }} mm</p>
    </section>

    <button class="alertas-btn" (click)="goToAlerts()">
      Configurar alertas por correo
    </button>

    <!-- NUEVA SECCI√ìN: historial / detalle -->
    <section class="history-section">
      <h2>Detalle temporal del evento de lluvia</h2>

      <div *ngIf="historyLoading">Cargando historial de pron√≥sticos...</div>
      <div *ngIf="historyError" class="error">{{ historyError }}</div>

      <div *ngIf="!historyLoading && history as h">

        <div class="history-summary">
          <p>
            <strong>M√°xima intensidad esperada:</strong>
            {{ h.summary.max_intensity_mm_h }} mm/h
            <span *ngIf="h.summary.max_intensity_time">
              (alrededor de {{ h.summary.max_intensity_time | date:'short' }})
            </span>
          </p>
          <p><strong>Lluvia acumulada 24h:</strong> {{ h.summary.total_24h_mm }} mm</p>
          <p><strong>Lluvia acumulada 48h:</strong> {{ h.summary.total_48h_mm }} mm</p>
          <p class="history-note">
            Estos valores permiten evaluar la carga h√≠drica que deber√° disipar la estructura
            y la posible saturaci√≥n del suelo alrededor del disipador.
          </p>
        </div>

        <table class="history-table">
          <thead>
            <tr>
              <th>Fecha y hora</th>
              <th>Lluvia (3h) [mm]</th>
              <th>Intensidad [mm/h]</th>
              <th>Riesgo por franja</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let e of h.entries">
              <td>{{ e.time | date:'short' }}</td>
              <td>{{ e.rain_3h_mm }}</td>
              <td>{{ e.intensity_mm_h }}</td>
              <td>{{ e.slot_risk }}</td>
            </tr>
          </tbody>
        </table>

      </div>
    </section>
  </main>
</div>
