<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="brand">
      <h1>üå¶Ô∏è Panel de Control</h1>
      <span class="location-badge">La Calera</span>
    </div>
    <button (click)="logout()" class="logout-btn">
      <span>Cerrar sesi√≥n</span>
      <i class="icon-logout"></i> </button>
  </header>

  <main class="dashboard-content">
    <section class="status-grid">
      <div class="section-title-full">
        <h2>Resumen Hidr√°ulico Actual</h2>
      </div>

      <div *ngIf="loading" class="loading-state">Cargando pron√≥stico...</div>
      <div *ngIf="error" class="error-banner">{{ error }}</div>

      <ng-container *ngIf="!loading && summary as s">
        <div class="stat-card risk-highlight" [ngClass]="'risk-' + s.current_risk.level.toLowerCase()">
          <div class="card-icon">‚ö†Ô∏è</div>
          <div class="card-info">
            <h3>Riesgo Actual</h3>
            <p class="big-stat">{{ s.current_risk.level }}</p>
            <span class="sub-stat">{{ s.current_risk.message }}</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="card-icon">üåßÔ∏è</div>
          <div class="card-info">
            <h3>Intensidad Lluvia</h3>
            <p class="big-stat">{{ s.current_rain.intensity_mm_h }} <small>mm/h</small></p>
            <span class="sub-stat">{{ s.current_rain.label }}</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="card-icon">‚è±Ô∏è</div>
          <div class="card-info">
            <h3>Pr√≥ximas {{ s.next_hours.window_hours }}h</h3>
            <p class="big-stat">{{ s.next_hours.accumulated_mm }} <small>mm</small></p>
            <span class="sub-stat">Nivel estimado: {{ s.next_hours.level }}</span>
          </div>
        </div>
      </ng-container>
    </section>

    <div class="actions-row">
      <button class="alertas-btn" (click)="goToAlerts()">
        üîî Configurar alertas por correo
      </button>
    </div>

    <section class="history-section card-panel">
      <div class="panel-header">
        <h2>Detalle del Evento</h2>
        <p class="panel-subtitle">An√°lisis temporal de carga h√≠drica</p>
      </div>

      <div *ngIf="historyLoading" class="loading-state">Cargando historial...</div>
      <div *ngIf="historyError" class="error-banner">{{ historyError }}</div>

      <div *ngIf="!historyLoading && history as h">
        <div class="history-stats-row">
          <div class="mini-stat">
            <span class="label">M√°x. Intensidad</span>
            <span class="value">{{ h.summary.max_intensity_mm_h }} mm/h</span>
            <span class="time" *ngIf="h.summary.max_intensity_time">{{ h.summary.max_intensity_time | date:'shortTime' }}</span>
          </div>
          <div class="mini-stat">
            <span class="label">Acumulado 24h</span>
            <span class="value">{{ h.summary.total_24h_mm }} mm</span>
          </div>
          <div class="mini-stat">
            <span class="label">Acumulado 48h</span>
            <span class="value">{{ h.summary.total_48h_mm }} mm</span>
          </div>
        </div>
        
        <p class="history-note">
          ‚ÑπÔ∏è Estos valores permiten evaluar la posible saturaci√≥n del suelo alrededor del disipador.
        </p>

        <div class="table-responsive">
          <table class="history-table">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Lluvia (3h)</th>
                <th>Intensidad</th>
                <th>Riesgo</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let e of h.entries">
                <td><strong>{{ e.time | date:'shortTime' }}</strong> <br> <small>{{ e.time | date:'MMM d' }}</small></td>
                <td>{{ e.rain_3h_mm }} mm</td>
                <td>{{ e.intensity_mm_h }} mm/h</td>
                <td><span class="badge" [ngClass]="'badge-' + e.slot_risk.toLowerCase()">{{ e.slot_risk }}</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>